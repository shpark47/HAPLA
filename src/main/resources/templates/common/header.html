<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:fragment="topbar">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="/css/header.css" rel="stylesheet" type="text/css">
</head>
<body>
<header class="header">
    <div class="logo-section">
        <span class="hapla-logo" onclick="location.href='/main'">HAPLA</span>
    </div>
    <div class="user-section">
        <label th:hidden="${session.loginUser != null}" id="login">ë¡œê·¸ì¸</label>
        <img th:src="@{${session.loginUser != null ? session.loginUser.profile : ''}}" alt="User Profile" class="user-profile" id="user-profile-image" th:hidden="${session.loginUser == null}">
        <div class="header-dropdown">
            <a onclick="openModal()">ë‚´ ì •ë³´</a>
            <a href="/comm/list">ì»¤ë®¤ë‹ˆí‹°</a>
            <a href="#">ì—¬í–‰ì§€ì¶”ì²œ</a>
            <a onclick="openTripPlanModal()">ì—¬í–‰ ì¼ì •</a>
            <a href="/review/main">ë¦¬ë·° ì‘ì„±</a>
            <a href="#">ë¬¸ì˜í•˜ê¸°</a>
            <a href="/users/logout">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </div>
</header>

<div class="header-modal hidden" role="dialog" id="editModal" align="center">
    <div class="header-modal-div">
        <button class="header-close-btn" aria-label="ë‹«ê¸°" onclick="closeModal()"></button>
        <div class="header-banner">HAPLA</div>
        <form class="edit-form">
            <div class="profile-image-container">
                <input type="hidden" name="userNo" id="userNo" th:value="${session.loginUser != null ? session.loginUser.userNo : ''}">
                <input type="hidden" name="oriNickname" id="oriNickname" th:value="${session.loginUser != null ? session.loginUser.nickname : ''}">
                <input type="hidden" name="profile" id="profileImg" th:value="${session.loginUser != null ? session.loginUser.profile : ''}">
                <img th:src="@{${session.loginUser != null ? session.loginUser.profile : '/img/ì‹œë‚˜ëª¨ë¡¤.jpg'}}"
                     alt="í”„ë¡œí•„ ì´ë¯¸ì§€" class="profile-image" id="profileImage">
                <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                <button type="button" class="image-upload-btn" onclick="document.getElementById('imageUpload').click()">
                    í”„ë¡œí•„ ì‚¬ì§„ ë³€ê²½
                </button>
            </div>

            <label for="nickname" class="header-modal-label">ë‹‰ë„¤ì„:</label>
            <input type="text" id="nickname" name="nickname" class="header-modal-input"
                   th:value="${session.loginUser != null ? session.loginUser.nickname : ''}" required>

            <button id="save" class="header-modal-button" type="button">ë³€ê²½ì‚¬í•­ ì €ì¥</button>
            <button type="button" class="delete-account-btn">íšŒì› íƒˆí‡´í•˜ê¸°</button>
        </form>
    </div>
</div>

<div class="header-modal hidden" role="dialog" id="joinModal" align="center">
    <div class="header-modal-div">
        <button class="header-close-btn" aria-label="ë‹«ê¸°"></button>
        <div class="header-banner">HAPLA</div>
        <form class="header-modal-form" id="joinForm">
            <input type="hidden" id="loginType" name="type">
            <input type="hidden" id="tokenId" name="tokenId">
            <input type="hidden" id="profile" name="profile">

            <img src="" alt="í”„ë¡œí•„ ì´ë¯¸ì§€" class="profile-image" id="loginImage">

            <label for="nickname" class="header-modal-label">ì´ë¦„:</label>
            <input type="text" id="loginName" name="name" class="header-modal-input" readonly>

            <label for="nickname" class="header-modal-label">ë‹‰ë„¤ì„:</label>
            <input type="text" id="nickname" name="nickname" class="header-modal-input" required>

            <label for="email" class="header-modal-label">ì´ë©”ì¼:</label>
            <input type="email" id="email" name="email" class="header-modal-input" required>

            <button id="joinBtn" class="header-modal-button" type="button">ê°€ì…í•˜ê¸°</button>
        </form>
    </div>
</div>

<div class="header-modal hidden" role="dialog" id="loginModal" align="center">
    <div class="header-modal-div">
        <button class="header-close-btn" aria-label="ë‹«ê¸°"></button>
        <h1 class="login-title">HAPLA</h1>
        <p class="login-subtitle">ì˜ˆì •ë¶€í„° ì¼ì •ê¹Œì§€ ì—¬í–‰ì´ ë” ì‰¬ì›Œì§‘ë‹ˆë‹¤</p>

        <button id="google-login-btn" class="login-btn" style="background: white"></button>
        <button id="kakao-login-btn" class="login-btn"><img src="/img/kakao.png" alt=""></button>
    </div>

    <!-- Kakao SDK -->
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>

    <!-- Google SDK -->
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="/js/login.js"></script>
    <script src="/js/join.js"></script>
</div>

<script src="/js/header.js"></script>
<script src="/js/trip.js"></script>

<!-- ì—¬í–‰ ì¼ì • ëª¨ë‹¬ -->
<div id="tripPlanModal" class="modal-trip hidden">
   <div class="modal-content">
      <!--  -->
      <div class="button-container">
         <button id="planListBtn" class="planList">ì¼ì • ëª©ë¡</button>
         <button id="makePlanBtn" class="makePlan" onclick="openCitySearchModal()">ì¼ì • ìƒì„±</button>
      </div>
   </div>
</div>

<!-- ë„ì‹œ ê²€ìƒ‰ ëª¨ë‹¬ -->
<div id="citySearchModal" class="modal-trip hidden">
    <div class="modal-content">

        <!-- <span class="close" onclick="closeCitySearchModal()">&times;</span> -->

        <!-- ê²€ìƒ‰ ì…ë ¥ì°½ -->
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="ë„ì‹œ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”..." oninput="filterCities()">
            <span class="search-icon">
               <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368"><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg>
            </span>
        </div>

        <!-- ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ -->
        <ul id="cityList"></ul>
    </div>
</div>
<!-- Google Places API ìŠ¤í¬ë¦½íŠ¸ -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCEHjTtVqBclz07ADqbkGjqGIe94Cq-S60&libraries=places"></script>


<<<<<<< HEAD
    // âŒ ëª¨ë‹¬ ë‹«ê¸°
    function closeCitySearchModal() {
        document.getElementById("citySearchModal").style.display = "none";
    }

    // ğŸ–±ï¸ ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.addEventListener("click", function(event) {
        const modal = document.getElementById("citySearchModal");
        if (event.target.innerText != 'ì—¬í–‰ ì¼ì •' && modal.style.display == 'block' && !modal.contains(event.target)) {
           console.log(modal.style.display);
         console.log(modal.contains(event.target));

	        console.log(modal.style.display);
			console.log(modal.contains(event.target));

            closeCitySearchModal();
        }
    });
	</script>
    <!-- Google Places API ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCEHjTtVqBclz07ADqbkGjqGIe94Cq-S60&libraries=places"></script>

    <script>
    // ğŸŒ Google Places API ìë™ì™„ì„± ê²€ìƒ‰ ì ìš©
    function initCitySearch() {
        const input = document.getElementById("searchInput");
        
        // ë¸Œë¼ìš°ì € ìë™ì™„ì„± ë„ê¸°
        input.setAttribute("autocomplete", "off");
        
        const autocomplete = new google.maps.places.Autocomplete(input, {
            types: ['geocode'],	// ë„ì‹œ ìë™ì™„ì„± ìµœì†Œí™”(ê²€ìƒ‰ì°½ ë“œë¡­ë‹¤ìš´ ë¹„í™œì„±í™”)
        	fields: ["name", "formatted_address", "geometry"],
        	// types: ['(cities)'], // ë„ì‹œë§Œ ê²€ìƒ‰
        });

        // âœ… ë„ì‹œ ì„ íƒ ì‹œ ì´ë²¤íŠ¸
        autocomplete.addListener("place_changed", function () {
            const place = autocomplete.getPlace();
            if (!place.geometry) {
                console.error("ë„ì‹œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            let addressParts = place.formatted_address.split(", "); // ğŸ”¥ ì£¼ì†Œë¥¼ ë°°ì—´ë¡œ ë³€í™˜
            let cityName = addressParts[0]; // ğŸ”¥ ì²« ë²ˆì§¸ ìš”ì†Œë§Œ ì €ì¥ (ì§€ì—­ëª…)

            // âœ… êµ­ê°€ëª… ì—†ì´ ì§€ì—­ëª…ë§Œ ì €ì¥í•˜ì—¬ ë„˜ê¸°ê¸°
            selectCity({
                name: cityName, // ğŸ”¥ ì§€ì—­ëª…ë§Œ ì €ì¥
                lat: place.geometry.location.lat(),
                lng: place.geometry.location.lng()
            });
        });

        // ê²€ìƒ‰ì–´ ì…ë ¥ ì´ë²¤íŠ¸ ì¶”ê°€(ì¸ê¸° ë„ì‹œ ë¦¬ìŠ¤íŠ¸ ë³€ê²½)
        input.addEventListener("input", function () {
            if (input.value.trim() == "") {
                displayCityList(); // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ë‹¤ì‹œ ì¸ê¸° ë„ì‹œ ì¶œë ¥
            } else {
                filterCities(input.value);
            }
        });
    }

    // âœ… ì¸ê¸° ë„ì‹œ ë¦¬ìŠ¤íŠ¸
    const popularCities = [
        { name: "ì„œìš¸", country: "ëŒ€í•œë¯¼êµ­", lat: 37.5665, lng: 126.9780 },
        { name: "ë¶€ì‚°", country: "ëŒ€í•œë¯¼êµ­", lat: 35.1796, lng: 129.0756 },
        { name: "ì œì£¼", country: "ëŒ€í•œë¯¼êµ­", lat: 33.4996, lng: 126.5312 },
        { name: "ì˜¤ì‚¬ì¹´", country: "ì¼ë³¸", lat: 34.6937, lng: 135.5023 },
        { name: "ë„ì¿„", country: "ì¼ë³¸", lat: 35.682839, lng: 139.759455 },
        { name: "ë°©ì½•", country: "íƒœêµ­", lat: 13.7563, lng: 100.5018 }
    ];

    // ğŸŒ† ê¸°ë³¸ ë„ì‹œ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
    function displayCityList() {
        const cityList = document.getElementById("cityList");
        cityList.innerHTML = ""; // ê¸°ì¡´ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”

        popularCities.forEach(city => {
            const li = createCityListItem(city);
            cityList.appendChild(li);
        });
    }

    // ğŸ” ë„ì‹œ ê²€ìƒ‰ ê¸°ëŠ¥ (ê²€ìƒ‰ëœ ê²°ê³¼ ì¶œë ¥)
    function filterCities(searchTerm) {
        const service = new google.maps.places.PlacesService(document.createElement("div"));

        const request = {
            query: searchTerm,
            fields: ["name", "formatted_address", "geometry"],
        };

        service.findPlaceFromQuery(request, function (results, status) {
            if (status === google.maps.places.PlacesServiceStatus.OK) {
                const cityList = document.getElementById("cityList");
                cityList.innerHTML = ""; // ê¸°ì¡´ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”

                results.forEach(place => {
                    if (!place.geometry) return;

                    const city = {
                        name: place.name,
                        country: place.formatted_address.split(", ").pop(),
                        lat: place.geometry.location.lat(),
                        lng: place.geometry.location.lng(),
                    };

                    const li = createCityListItem(city);
                    cityList.appendChild(li);
                });
            }
        });
    }

    // ğŸŒ ë„ì‹œ ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ìƒì„± í•¨ìˆ˜
    function createCityListItem(city) {
        const li = document.createElement("li");

        // ğŸ“ ì•„ì´ì½˜ ì¶”ê°€
        const icon = document.createElement("span");
        icon.classList.add("city-icon");
        icon.textContent = "ğŸ“";

        // ğŸŒ ë„ì‹œ ì´ë¦„
        const cityName = document.createElement("span");
        cityName.textContent = city.name;
        cityName.style.fontWeight = "bold";
        cityName.style.marginRight = "10px";

        // ğŸŒ êµ­ê°€ ì´ë¦„
        const countryName = document.createElement("span");
        countryName.classList.add("country-name");
        countryName.textContent = city.country;

        li.appendChild(icon);
        li.appendChild(cityName);
        li.appendChild(countryName);

        li.onclick = function () {
            selectCity(city);
        };

        return li;
    }

    // âœ… ë„ì‹œ ì„ íƒ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ (ë„ì‹œ ì •ë³´ ì €ì¥ & í˜ì´ì§€ ì´ë™)
    function selectCity(city) {
        localStorage.setItem("selectedCity", JSON.stringify(city));
        console.log(`ğŸ“ ì„ íƒí•œ ë„ì‹œ: ${city.name}, ${city.country}`);

        // âœ… ì¼ì • í˜ì´ì§€ë¡œ ì´ë™ (ê¸°ë³¸ í˜ì´ì§€ê°€ /schedule/scheduleCalendar ì¸ ê²½ìš°)
        window.location.href = "/schedule/scheduleCalendar";
    }

    // âœ… í˜ì´ì§€ ë¡œë“œ í›„ Google Places API ì´ˆê¸°í™” ì‹¤í–‰
    window.onload = function () {
        initCitySearch();
        displayCityList();
    };
</script>
=======
>>>>>>> 05d239e25e7dfa4e2eba3540a81fadde7e535ae2
</body>
</html>