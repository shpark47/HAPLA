<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—¬í–‰ ì¼ì • ì„ íƒ</title>
    <link rel="stylesheet" href="/css/scheduleCalendar.css" type="text/css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>

    <!-- ğŸŒ Google Maps ë°°ê²½ -->
    <div id="map"></div>

    <!-- ğŸ“… ì™•ë³µ ë‚ ì§œ ì„ íƒ ëª¨ë‹¬ -->
    <div id="calendarModal" class="modal">
        <span class="close" onclick="closeCalendarModal()">&times;</span>
        <h2>ì—¬í–‰ ì¼ì •ì„ ì„ íƒí•˜ì„¸ìš”</h2>
        
        <div class="calendar-container">
            <!-- ğŸ›« ì¶œë°œ ë‚ ì§œ -->
            <div class="calendar-box">
                <label for="startDate">ì¶œë°œ ë‚ ì§œ</label>
                <input type="text" id="startDate" placeholder="ì¶œë°œ ë‚ ì§œ ì„ íƒ">
            </div>
            
            <!-- ğŸ›¬ ë„ì°© ë‚ ì§œ -->
            <div class="calendar-box">
                <label for="endDate">ë„ì°© ë‚ ì§œ</label>
                <input type="text" id="endDate" placeholder="ë„ì°© ë‚ ì§œ ì„ íƒ">
            </div>
        </div>

        <button onclick="saveDates()">ì €ì¥</button>
    </div>

    <script src="/js/schedule.js"></script>

	<script>
	// âœ… ì¼ì • í˜ì´ì§€ê°€ ë¡œë“œë  ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
    function initMap() {
        // âœ… localStorageì—ì„œ ì„ íƒí•œ ë„ì‹œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const storedCity = localStorage.getItem("selectedCity");

        // ê¸°ë³¸ ì§€ë„ ìœ„ì¹˜ ì„¤ì • (ì´ˆê¸°ê°’: íŒŒë¦¬)
        let mapOptions = {
            center: { lat: 37.5665, lng: 126.9780 }, // ì„œìš¸ ê¸°ë³¸ ìœ„ì¹˜
            zoom: 10
        };

        // âœ… ì €ì¥ëœ ë„ì‹œ ì •ë³´ê°€ ìˆìœ¼ë©´ ì§€ë„ ìœ„ì¹˜ ë³€ê²½
        if (storedCity) {
            const city = JSON.parse(storedCity);
            mapOptions.center = { lat: city.lat, lng: city.lng }; // ì„ íƒí•œ ë„ì‹œ ì¢Œí‘œë¡œ ì´ë™
            console.log(`ğŸ“ ì§€ë„ ìœ„ì¹˜ ë³€ê²½: ${city.name}, ${city.country}`);
        }

        // âœ… Google ì§€ë„ ìƒì„±
        new google.maps.Map(document.getElementById('map'), mapOptions);
    }
		</script>

		 <!-- Google Maps API -->
		    <script async defer
		        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAUKMdSgSqvtUy4wZvUxqA6I_c0Zk4InEU&callback=initMap">
		    </script>
		
		<script>
		// ğŸ“… ìº˜ë¦°ë” ëª¨ë‹¬ ìë™ ì—´ê¸°
		document.addEventListener("DOMContentLoaded", function () {
		    openCalendarModal();
		    initDatePickers();
		});

		function openCalendarModal() {
		    document.getElementById("calendarModal").style.display = "block";
		}

		function closeCalendarModal() {
		    document.getElementById("calendarModal").style.display = "none";
		} 

		// âœ… ë‚ ì§œ ì„ íƒ ë¼ì´ë¸ŒëŸ¬ë¦¬ (Flatpickr) ì ìš©
		function initDatePickers() {
		    flatpickr("#startDate", {
		        dateFormat: "Y-m-d",
		        minDate: "today",
		        static: true,	// ìº˜ë¦°ë” í•­ìƒ ì—´ë ¤ ìˆë„ë¡ ì„¤ì •
		       	locale: "ko",	// í•œêµ­ì–´ ì„¤ì •
		        onClose: function(selectedDates) {
		            if (selectedDates.length > 0) {
		                flatpickr("#endDate", {
		                    dateFormat: "Y-m-d",
		                    minDate: selectedDates[0].fp_incr(1), // ì¶œë°œì¼ ë‹¤ìŒ ë‚ ë¶€í„° ì„ íƒ ê°€ëŠ¥
		                    static: true,
		                    locale: "ko"
		                });
		            }
		        }
		    });

		    flatpickr("#endDate", {
		        dateFormat: "Y-m-d",
		        minDate: "today",
		        static: true,
		        locale: "ko"
		    });
		}

		function saveDates() {
		    const startDate = document.getElementById("startDate").value;
		    const endDate = document.getElementById("endDate").value;
		    const storedCity = localStorage.getItem("selectedCity"); // ê¸°ì¡´ì— ì„ íƒí•œ ë„ì‹œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°

		    if (startDate && endDate && storedCity) {
		        const tripData = {
		        		city: JSON.parse(storedCity), // ê¸°ì¡´ ë„ì‹œ ì •ë³´ ìœ ì§€
		        		startDate: startDate,
		        		endDate: endDate
		        };

		        localStorage.setItem("tripData", JSON.stringify(tripData)); // ğŸ”¥ ë‚ ì§œê¹Œì§€ ì €ì¥
		        window.location.href = "/schedule/schedule"; // ğŸ”¥ ì¼ì • í˜ì´ì§€ë¡œ ì´ë™
		    } else {
		        alert("ì¶œë°œ ë‚ ì§œì™€ ë„ì°© ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”!");
		    }
		}

		</script>

	<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
	<script src="https://npmcdn.com/flatpickr@4.6.13/dist/l10n/ko.js"></script>
	
</body>
</html>
