<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAPLA Travel</title>
    <link href="/css/main.css" rel="stylesheet" type="text/css">
    <script src="https://code.jquery.com/jquery-3.7.1.js"
            integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
</head>
<body>
<div th:replace="~{common/header.html :: topbar}"></div>
<main>
    <section th:replace="~{common/search.html :: search}"></section>

    <!-- í•­ê³µê¶Œ ê²€ìƒ‰ ì°½ -->
    <!--        <form class="search-form">-->
    <!--            <div class="input-group">-->
    <!--                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">-->
    <!--                    <path d="M22 2L2 22M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/>-->
    <!--                </svg>-->
    <!--                <input type="text" placeholder="Origin">-->
    <!--            </div>-->

    <!--            <div class="input-group">-->
    <!--                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">-->
    <!--                    <path d="M22 2L2 22M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/>-->
    <!--                </svg>-->
    <!--                <input type="text" placeholder="Destination">-->
    <!--            </div>-->

    <!--            <button type="button" class="date-picker">Feb 20 â†’ Feb 27</button>-->
    <!--            <button type="button" class="traveler-picker">1 Traveler</button>-->
    <!--            <button type="submit" class="search-btn">Search</button>-->
    <!--        </form>-->


    <section class="popular-destinations">
        <h2>ì¸ê¸° ì—¬í–‰ì§€</h2>
        <div class="destinations-grid">
            <div class="destination-card">
                <img src="/img/ì‹œë‚˜ëª¨ë¡¤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>ì œì£¼ë„</h3>
                    <p>ì•„ë¦„ë‹¤ìš´ ìì—°ê³¼ ë¬¸í™”ì˜ ì„¬</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/ì‹œë‚˜ëª¨ë¡¤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>ë¶€ì‚°</h3>
                    <p>í•´ë³€ë„ì‹œì˜ ë§¤ë ¥</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/ì‹œë‚˜ëª¨ë¡¤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>ì„œìš¸</h3>
                    <p>í˜„ëŒ€ì™€ ì „í†µì´ ê³µì¡´í•˜ëŠ” ë„ì‹œ</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/ì‹œë‚˜ëª¨ë¡¤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>ê²½ì£¼</h3>
                    <p>ì²œë…„ê³ ë„ì˜ ì—­ì‚¬</p>
                </div>
            </div>
        </div>
    </section>
    <section class="popular-destinations">
        <h2>ì¸ê¸° ì—¬í–‰ì§€</h2>
        <div class="destinations-grid">
            <div class="destination-card">
                <img src="/img/ì‹œë‚˜ëª¨ë¡¤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>ì œì£¼ë„</h3>
                    <p>ì•„ë¦„ë‹¤ìš´ ìì—°ê³¼ ë¬¸í™”ì˜ ì„¬</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/ì‹œë‚˜ëª¨ë¡¤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>ë¶€ì‚°</h3>
                    <p>í•´ë³€ë„ì‹œì˜ ë§¤ë ¥</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/ì‹œë‚˜ëª¨ë¡¤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>ì„œìš¸</h3>
                    <p>í˜„ëŒ€ì™€ ì „í†µì´ ê³µì¡´í•˜ëŠ” ë„ì‹œ</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/ì‹œë‚˜ëª¨ë¡¤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>ê²½ì£¼</h3>
                    <p>ì²œë…„ê³ ë„ì˜ ì—­ì‚¬</p>
                </div>
            </div>
        </div>
    </section>
    <section class="popular-destinations">
        <h2>ì¸ê¸° ì—¬í–‰ì§€</h2>
        <div class="destinations-grid">
            <div class="destination-card">
                <img src="/img/ì‹œë‚˜ëª¨ë¡¤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>ì œì£¼ë„</h3>
                    <p>ì•„ë¦„ë‹¤ìš´ ìì—°ê³¼ ë¬¸í™”ì˜ ì„¬</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/ì‹œë‚˜ëª¨ë¡¤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>ë¶€ì‚°</h3>
                    <p>í•´ë³€ë„ì‹œì˜ ë§¤ë ¥</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/ì‹œë‚˜ëª¨ë¡¤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>ì„œìš¸</h3>
                    <p>í˜„ëŒ€ì™€ ì „í†µì´ ê³µì¡´í•˜ëŠ” ë„ì‹œ</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/ì‹œë‚˜ëª¨ë¡¤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>ê²½ì£¼</h3>
                    <p>ì²œë…„ê³ ë„ì˜ ì—­ì‚¬</p>
                </div>
            </div>
        </div>
    </section>
    <section class="popular-destinations">
        <h2>ì¸ê¸° ì—¬í–‰ì§€</h2>
        <div class="destinations-grid">
            <div class="destination-card">
                <img src="/img/ì‹œë‚˜ëª¨ë¡¤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>ì œì£¼ë„</h3>
                    <p>ì•„ë¦„ë‹¤ìš´ ìì—°ê³¼ ë¬¸í™”ì˜ ì„¬</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/ì‹œë‚˜ëª¨ë¡¤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>ë¶€ì‚°</h3>
                    <p>í•´ë³€ë„ì‹œì˜ ë§¤ë ¥</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/ì‹œë‚˜ëª¨ë¡¤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>ì„œìš¸</h3>
                    <p>í˜„ëŒ€ì™€ ì „í†µì´ ê³µì¡´í•˜ëŠ” ë„ì‹œ</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/ì‹œë‚˜ëª¨ë¡¤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>ê²½ì£¼</h3>
                    <p>ì²œë…„ê³ ë„ì˜ ì—­ì‚¬</p>
                </div>
            </div>
        </div>
    </section>
</main>
<div th:replace="~{common/footer.html :: foot}"></div>

<div class="modal hidden" role="dialog" id="joinModal" align="center">
    <div class="modal-div">
        <button class="close-btn" aria-label="ë‹«ê¸°"></button>
        <div class="banner">HAPLA</div>
        <form class="modal-form">
            <img src="" alt="í”„ë¡œí•„ ì´ë¯¸ì§€" class="profile-image" id="loginImage">

            <label for="nickname" class="modal-label">ì´ë¦„:</label>
            <input type="text" id="loginName" name="name" class="modal-input" readonly>

            <label for="nickname" class="modal-label">ë‹‰ë„¤ì„:</label>
            <input type="text" id="nickname" name="nickname" class="modal-input" required>

            <label for="email" class="modal-label">ì´ë©”ì¼:</label>
            <input type="email" id="email" name="email" class="modal-input" required>

            <button id="join" class="modal-button" type="submit">ê°€ì…í•˜ê¸°</button>
        </form>
    </div>
</div>

<div class="modal hidden" role="dialog" id="loginModal" align="center">
    <div class="modal-div">
        <button class="close-btn" aria-label="ë‹«ê¸°"></button>
        <h1 class="login-title">HAPLA</h1>
        <p class="login-subtitle">ì˜ˆì •ë¶€í„° ì¼ì •ê¹Œì§€ ì—¬í–‰ì´ ë” ì‰¬ì›Œì§‘ë‹ˆë‹¤</p>

        <button id="google-login-btn" class="login-btn" style="background: white"></button>
        <button id="kakao-login-btn" class="login-btn"><img src="/img/kakao.png" alt=""></button>
    </div>

    <!-- Kakao SDK -->
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>

    <script>
        // âœ… ì¹´ì¹´ì˜¤ SDK ì´ˆê¸°í™”
        Kakao.init("04cff7eb62f268a2bb506c81bf1de17b");

        // âœ… ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰
        document.getElementById("kakao-login-btn").addEventListener("click", function () {
            Kakao.Auth.login({
                scope: "profile_nickname, profile_image",
                success: function (authObj) {
                    console.log("âœ… ë¡œê·¸ì¸ ì„±ê³µ! ì•¡ì„¸ìŠ¤ í† í°:", authObj.access_token);

                    // âœ… ì•¡ì„¸ìŠ¤ í† í°ì„ ì´ìš©í•˜ì—¬ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    fetchUserInfo(authObj.access_token);
                },
                fail: function (err) {
                    console.error("âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨", err);
                },
            });
        });

        // âœ… ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì™€ì„œ ëª¨ë‹¬ ì—…ë°ì´íŠ¸
        function fetchUserInfo(accessToken) {
            Kakao.API.request({
                url: "/v2/user/me",
                success: function (response) {
                    console.log("âœ… ì‚¬ìš©ì ì •ë³´:", response);

                    // ğŸ”¹ í”„ë¡œí•„ ì •ë³´ ëª¨ë‹¬ì— ì ìš©
                    updateModal(response);

                    // ğŸ”¹ ì•¡ì„¸ìŠ¤ í† í° & ì‚¬ìš©ì ì •ë³´ ì €ì¥
                    localStorage.setItem("accessToken", accessToken);
                    localStorage.setItem("userInfo", JSON.stringify(response));
                },
                fail: function (error) {
                    console.error("âŒ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨", error);
                },
            });
        }

        // âœ… ëª¨ë‹¬ì°½ ì—…ë°ì´íŠ¸ (í”„ë¡œí•„ ì´ë¯¸ì§€ & ë‹‰ë„¤ì„)
        function updateModal(userInfo) {
            const modal = document.getElementById("joinModal");
            const profileImage = document.getElementById("loginImage");
            const nicknameInput = document.getElementById("loginName");

            // ğŸ”¹ ì‚¬ìš©ì ì •ë³´ ì ìš©
            profileImage.src = userInfo.properties.profile_image || "";
            nicknameInput.value = userInfo.properties.nickname || "ì‚¬ìš©ì";

            // ğŸ”¹ ëª¨ë‹¬ì°½ í‘œì‹œ
            document.getElementById('loginModal').classList.add('hidden');
            modal.classList.remove("hidden");
        }
    </script>

    <!-- Google SDK -->
    <script src="https://accounts.google.com/gsi/client"></script>

    <script>
        // Google ë¡œê·¸ì¸ ë²„íŠ¼
        google.accounts.id.initialize({
            client_id: 'YOUR_GOOGLE_CLIENT_ID',
            callback: handleCredentialResponse
        });
        google.accounts.id.renderButton(
            document.getElementById("google-login-btn"),
            { theme: "outline", size: "large", width: "100%" }
        );

        function handleCredentialResponse(response) {
            console.log("Encoded JWT ID token: " + response.credential);
            // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì²˜ë¦¬
        }
    </script>
</div>

<div class="modal hidden" role="dialog" id="editModal" align="center">
    <div class="modal-div">
        <button class="close-btn" aria-label="ë‹«ê¸°" onclick="closeModal()"></button>
        <div class="banner">HAPLA</div>
        <form class="edit-form">
            <div class="profile-image-container">
                <img src="/img/ì‹œë‚˜ëª¨ë¡¤.jpg" alt="í”„ë¡œí•„ ì´ë¯¸ì§€" class="profile-image" id="profileImage">
                <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                <button type="button" class="image-upload-btn" onclick="document.getElementById('imageUpload').click()">
                    í”„ë¡œí•„ ì‚¬ì§„ ë³€ê²½
                </button>
            </div>

            <label for="nickname" class="modal-label">ë‹‰ë„¤ì„:</label>
            <input type="text" id="nickname" name="nickname" class="modal-input" required>

            <button id="save" class="modal-button" type="submit">ë³€ê²½ì‚¬í•­ ì €ì¥</button>

            <button type="button" class="delete-account-btn">íšŒì› íƒˆí‡´í•˜ê¸°</button>
        </form>
    </div>
</div>

<script src="/js/main.js"></script>
</body>
</html>