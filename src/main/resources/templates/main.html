<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAPLA Travel</title>
    <link href="/css/main.css" rel="stylesheet" type="text/css">
    <script src="https://code.jquery.com/jquery-3.7.1.js"
            integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
</head>
<body>
<div th:replace="~{common/header.html :: topbar}"></div>
<main>
    <section th:replace="~{common/search.html :: search}"></section>
    <section class="popular-destinations">
        <h2>인기 여행지</h2>
        <div class="destinations-grid">
            <div class="destination-card">
                <img src="/img/시나모롤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>제주도</h3>
                    <p>아름다운 자연과 문화의 섬</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/시나모롤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>부산</h3>
                    <p>해변도시의 매력</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/시나모롤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>서울</h3>
                    <p>현대와 전통이 공존하는 도시</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/시나모롤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>경주</h3>
                    <p>천년고도의 역사</p>
                </div>
            </div>
        </div>
    </section>
    <section class="popular-destinations">
        <h2>인기 여행지</h2>
        <div class="destinations-grid">
            <div class="destination-card">
                <img src="/img/시나모롤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>제주도</h3>
                    <p>아름다운 자연과 문화의 섬</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/시나모롤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>부산</h3>
                    <p>해변도시의 매력</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/시나모롤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>서울</h3>
                    <p>현대와 전통이 공존하는 도시</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/시나모롤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>경주</h3>
                    <p>천년고도의 역사</p>
                </div>
            </div>
        </div>
    </section>
    <section class="popular-destinations">
        <h2>인기 여행지</h2>
        <div class="destinations-grid">
            <div class="destination-card">
                <img src="/img/시나모롤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>제주도</h3>
                    <p>아름다운 자연과 문화의 섬</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/시나모롤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>부산</h3>
                    <p>해변도시의 매력</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/시나모롤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>서울</h3>
                    <p>현대와 전통이 공존하는 도시</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/시나모롤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>경주</h3>
                    <p>천년고도의 역사</p>
                </div>
            </div>
        </div>
    </section>
    <section class="popular-destinations">
        <h2>인기 여행지</h2>
        <div class="destinations-grid">
            <div class="destination-card">
                <img src="/img/시나모롤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>제주도</h3>
                    <p>아름다운 자연과 문화의 섬</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/시나모롤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>부산</h3>
                    <p>해변도시의 매력</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/시나모롤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>서울</h3>
                    <p>현대와 전통이 공존하는 도시</p>
                </div>
            </div>
            <div class="destination-card">
                <img src="/img/시나모롤.jpg" alt="Destination">
                <div class="destination-info">
                    <h3>경주</h3>
                    <p>천년고도의 역사</p>
                </div>
            </div>
        </div>
    </section>
</main>
<div th:replace="~{common/footer.html :: foot}"></div>

<div class="modal hidden" role="dialog" id="joinModal" align="center">
    <div class="modal-div">
        <button class="close-btn" aria-label="닫기"></button>
        <div class="banner">HAPLA</div>
        <form class="modal-form" id="joinForm">
            <input type="hidden" id="loginType" name="type">
            <input type="hidden" id="tokenId" name="tokenId">
            <input type="hidden" id="profile" name="profile">

            <img src="" alt="프로필 이미지" class="profile-image" id="loginImage">

            <label for="nickname" class="modal-label">이름:</label>
            <input type="text" id="loginName" name="name" class="modal-input" readonly>

            <label for="nickname" class="modal-label">닉네임:</label>
            <input type="text" id="nickname" name="nickname" class="modal-input" required>

            <label for="email" class="modal-label">이메일:</label>
            <input type="email" id="email" name="email" class="modal-input" required>

            <button id="joinBtn" class="modal-button" type="button">가입하기</button>
        </form>
    </div>
</div>

<div class="modal hidden" role="dialog" id="loginModal" align="center">
    <div class="modal-div">
        <button class="close-btn" aria-label="닫기"></button>
        <h1 class="login-title">HAPLA</h1>
        <p class="login-subtitle">예정부터 일정까지 여행이 더 쉬워집니다</p>

        <button id="google-login-btn" class="login-btn" style="background: white"></button>
        <button id="kakao-login-btn" class="login-btn"><img src="/img/kakao.png" alt=""></button>
    </div>

    <!-- Kakao SDK -->
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>

    <!-- Google SDK -->
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="/js/login.js"></script>
    <script src="/js/join.js"></script>
</div>

<div class="modal hidden" role="dialog" id="editModal" align="center">
    <div class="modal-div">
        <button class="close-btn" aria-label="닫기" onclick="closeModal()"></button>
        <div class="banner">HAPLA</div>
        <form class="edit-form">
            <div class="profile-image-container">
                <img th:src="@{${session.loginUser != null ? session.loginUser.profile : ''}}" alt="프로필 이미지" class="profile-image" id="profileImage">
                <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                <button type="button" class="image-upload-btn" onclick="document.getElementById('imageUpload').click()">
                    프로필 사진 변경
                </button>
            </div>

            <label for="nickname" class="modal-label">닉네임:</label>
            <input type="text" id="nickname" name="nickname" class="modal-input" th:value="${session.loginUser != null ? session.loginUser.nickname : ''}" required>

            <button id="save" class="modal-button" type="submit">변경사항 저장</button>

            <button type="button" class="delete-account-btn">회원 탈퇴하기</button>
        </form>
    </div>
</div>

<script src="/js/main.js"></script>

<!-- 🌍 도시 검색 모달 -->
<div id="citySearchModal" class="modal-trip">
    <div class="modal-content">
        <span class="close" onclick="closeCitySearchModal()">&times;</span>
        <h2>도시를 검색하세요</h2>
        <input type="text" id="searchInput" placeholder="도시 이름을 입력하세요..." oninput="filterCities()">
        <ul id="cityList"></ul>
    </div>
</div>

<script>
//🌍 모달 열기
function openCitySearchModal() {
    document.getElementById("citySearchModal").style.display = "block";
}

// ❌ 모달 닫기
function closeCitySearchModal() {
    document.getElementById("citySearchModal").style.display = "none";
}

// 🖱️ 모달 외부 클릭 시 닫기
window.addEventListener("click", function(event) {
    const modal = document.getElementById("citySearchModal");
    if (event.target === modal) {
        closeCitySearchModal();
    }
});

// 🌍 REST Countries API에서 수도(도시) 검색
let cities = [];

async function fetchCities() {
    try {
        const response = await fetch("https://restcountries.com/v3.1/all");
        const data = await response.json();
        cities = data.map(country => ({
            name: country.capital ? country.capital[0] : "",
            country: country.translations.kor?.common || country.name.common
        })).filter(city => city.name); // 수도가 없는 경우 제거
    } catch (error) {
        console.error("도시 데이터를 불러오는 중 오류 발생:", error);
    }
}

fetchCities(); // API에서 데이터 가져오기

// 🔍 도시 검색 기능
function filterCities() {
    const searchTerm = document.getElementById("searchInput").value.toLowerCase();
    const filteredCities = cities.filter(city =>
        city.name.toLowerCase().includes(searchTerm) ||
        city.country.toLowerCase().includes(searchTerm)
    );

    displayCities(filteredCities);
}

// 🌆 검색된 도시 목록 표시
function displayCities(cityArray) {
    const cityList = document.getElementById("cityList");
    cityList.innerHTML = "";

    cityArray.forEach(city => {
        const li = document.createElement("li");
        li.textContent = `${city.name}, ${city.country}`;
        li.onclick = function () {
            selectCity(city);
        };
        cityList.appendChild(li);
    });
}

// ✅ 도시 선택 후 일정 페이지로 이동
function selectCity(city) {
    localStorage.setItem("selectedCity", JSON.stringify(city));
    window.location.href = "/scheduleCalendar.html";
}
</script>
</body>
</html>