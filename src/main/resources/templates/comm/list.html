<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAPLA ì»¤ë®¤ë‹ˆí‹°</title>
    <link href="/css/list.css" rel="stylesheet" type="text/css">
</head>
<body>
    <!-- í—¤ë” í¬í•¨ -->
    <div th:replace="~{common/header.html :: topbar}"></div>
    
    <main>
        <section class="banner">
            <img src="/img/communityBanner.png" alt="ì»¤ë®¤ë‹ˆí‹° ë°°ë„ˆ">
            <!-- ğŸ”¹ ê²€ìƒ‰ í¼ -->
            <form action="/comm/list" method="GET" onsubmit="return validateForm()">
                <div class="search">
                    <h1>ì—¬í–‰ì˜ ì„¤ë ˜ì„ í•¨ê»˜ ë‚˜ëˆ„ëŠ” ê³µê°„ ë‹¹ì‹ ì˜ ì •ë³´ë¥¼ ê³µìœ í•´ë³´ì„¸ìš”</h1>
                    <div class="searchDiv">
	                    <select name="category" id="category">
						        <option value="0" th:selected="${category == '0'}">ì „ì²´</option>
						        <option value="1">ì§€ì—­</option>
								<option value="2">í•­ê³µê¶Œ</option>
								<option value="3">ìˆ™ì†Œ</option>
								<option value="4">ì¦ê¸¸ê±°ë¦¬</option>
								<option value="5">ìŒì‹ì </option>
						    </select>
	                    <input type="search" name="search" id="search" placeholder="ì¥ì†Œ ë˜ëŠ” ì•¡í‹°ë¹„í‹°ë¡œ ê²€ìƒ‰" th:value="${search}">
	                    <button type="submit">
	                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
	                            <path fill="#306263" d="M21.562,18.733l-2.767-2.767c-0.569-0.569-0.779-1.431-0.465-2.172 c0.588-1.386,0.822-2.957,0.57-4.609c-0.548-3.591-3.422-6.507-7.01-7.075c-5.779-0.915-10.695,4-9.779,9.779 
	                            c0.568,3.588,3.484,6.461,7.075,7.01c1.652,0.252,3.223,0.019,4.609-0.57c0.741-0.315,1.603-0.104,2.172,0.465l2.767,2.767
	                            c0.586,0.586,1.536,0.586,2.121,0l0.707-0.707C22.148,20.269,22.148,19.319,21.562,18.733z M4,10.5C4,6.916,6.916,4,10.5,4
	                            S17,6.916,17,10.5S14.084,17,10.5,17S4,14.084,4,10.5z"></path>
	                        </svg>
	                    </button>
                    </div>
                </div>
            </form>
        </section>

        <section class="community">
            <h2>ì»¤ë®¤ë‹ˆí‹°</h2>
            <table>
                <thead>
                    <tr>
                        <th width="10%">ì¹´í…Œê³ ë¦¬</th>
                        <th width="45%">ì œëª©</th>
                        <th width="10%">ì‘ì„±ì</th>
                        <th width="10%">ì¢‹ì•„ìš”</th>
                        <th width="10%">ì¡°íšŒìˆ˜</th>
                        <th width="15%">ë“±ë¡ì¼</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="comm : ${list}" th:data-comm-no="${comm.commNo}">
                        <td>[[${comm.categoryName}]]</td>
                        <td>[[${comm.title}]]</td>
                        <td>[[${comm.name}]]</td>
                        <td>[[${comm.likes}]]</td>
                        <td>[[${comm.views}]]</td>
                        <td>[[${#dates.format(comm.createDate, 'yyyy-MM-dd')}]]</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- ğŸ”¹ í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div class="pagination-container">
            <ul class="pagination">
                <!-- ì´ì „ í˜ì´ì§€ -->
                <li class="page-item" th:classappend="${pi.currentPage == 1} ? 'disabled'">
                    <a class="page-link" th:href="@{/comm/list(page=${pi.currentPage-1}, search=${search})}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>

                <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
                <li class="page-item" th:each="p : ${#numbers.sequence(pi.startPage, pi.endPage)}"
                    th:classappend="${p == pi.currentPage} ? 'active'">
                    <a class="page-link" th:href="@{/comm/list(page=${p}, search=${search})}">[[${p}]]</a>
                </li>

                <!-- ë‹¤ìŒ í˜ì´ì§€ -->
                <li class="page-item" th:classappend="${pi.currentPage == pi.endPage} ? 'disabled'">
                    <a class="page-link" th:href="@{/comm/list(page=${pi.currentPage+1}, search=${search})}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- ìƒˆ ê¸€ ì‘ì„± ë²„íŠ¼ -->
        <button class="btn btn-outline-success" type="button" onclick="location.href='/comm/write'">ìƒˆ ê¸€ ì‘ì„±</button>
    </main>    

    <!-- í‘¸í„° í¬í•¨ -->
    <div th:replace="~{common/footer.html :: foot}"></div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // ğŸ”¹ ê²Œì‹œê¸€ í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ ì´ë™
            document.querySelectorAll("tbody tr").forEach(row => {
                row.addEventListener("click", function () {
                    const commNo = this.getAttribute("data-comm-no");
                    const currentPage = "[[${pi.currentPage}]]";
                    location.href = `/comm/` + commNo + `/` + currentPage;
                });
            });

            // ğŸ”¹ ê²€ìƒ‰ í¼ ìœ íš¨ì„± ê²€ì‚¬
            document.querySelector("form").addEventListener("submit", function (event) {
                const searchValue = document.getElementById("search").value.trim();
                if (searchValue === '') {
                    alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                    event.preventDefault();
                }
            });
        });
    </script>
</body>
</html>
